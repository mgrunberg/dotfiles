#!/bin/bash

echo "--> Linking config files"

ln -isT $(readlink -f vim) ~/.vim

ln -is $(readlink -f bash_aliases) ~/.bash_aliases
ln -is $(readlink -f gemrc) ~/.gemrc
ln -is $(readlink -f gitconfig) ~/.gitconfig
ln -is $(readlink -f gitignore) ~/.gitignore
ln -is $(readlink -f gvimrc) ~/.gvimrc
ln -is $(readlink -f irbrc) ~/.irbrc
ln -is $(readlink -f tmux.conf) ~/.tmux.conf
ln -is $(readlink -f vimrc) ~/.vimrc
ln -is $(readlink -f zshrc) ~/.zshrc

if [ ! -f "/etc/docker/daemon.json" ]; then
  echo "--> Creating docker daemon config file '/etc/docker/daemon.json'"
  sudo mkdir -p /etc/docker
  echo "{\"data-root\": \"$HOME/docker\", \"log-opts\": { \"max-file\": \"3\", \"max-size\": \"100m\" } }" | sudo tee -a "/etc/docker/daemon.json"
else
  echo "--> Docker daemon.json already exist, skipping."
fi


echo "--> Installing zsh plugins"

CURRENT_DIR=`pwd`
ZSH_PLUGINS_DIR="$HOME/.oh-my-zsh/custom/plugins"
mkdir -p "$ZSH_PLUGINS_DIR" && cd "$ZSH_PLUGINS_DIR"
if [ ! -d "$ZSH_PLUGINS_DIR/zsh-syntax-highlighting" ]; then
  echo "-----> Installing 'zsh-syntax-highlighting'"
  git clone https://github.com/zsh-users/zsh-autosuggestions
  git clone https://github.com/zsh-users/zsh-completions
  git clone https://github.com/zsh-users/zsh-syntax-highlighting
else
  echo "-----> 'zsh-syntax-highlighting' is already installed, skipping."
fi
cd "$CURRENT_DIR"


echo "--> Preparing tmux plugins"

if [ ! -d $HOME/.tmux/plugins/tpm ]; then
  echo "-----> Installing tmux plugin manager"
  git clone https://github.com/tmux-plugins/tpm $HOME/.tmux/plugins/tpm
  $HOME/.tmux/plugins/tpm/bin/install_plugins
fi

if [ ! command -v xclip >/dev/null 2>&1 ]; then
  echo "-----> Installing xclip for tmux-yank"
  sudo apt install -y xclip
else
  echo "-----> xclip is already installed, skipping."
fi

echo "--> Done!"

